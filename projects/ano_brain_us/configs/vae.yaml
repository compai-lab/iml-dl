name: VAE
target_size: !!python/tuple &target_size [128, 128]
dbatch_size: &dbatch_size 1
checkpoint_path: &checkpoint_path ./weights/phanes_miccai/sota/
#
# Experiment
#
experiment:
  name: vae
  task: test
  weights: "./weights/phanes_miccai/sota/2023_03_24_08_37_57_523843/best_model.pt"
#  weights:  './weights/phanes_miccai/sota/2023_01_31_16_04_55_377770/best_model.pt'

#
device: cpu
configurator:
  module_name: core.Configurator
  class_name: DLConfigurator
  params:
#
# Model
#

#
# Model
#
model:
  module_name: model_zoo.vae_hahn
  class_name: VAE
  params:
    input_size: !!python/tuple [1, 128, 128]
    h_size:
      - 16
      - 32
      - 64
      - 256
      - 256 #for input 128, 128
    z_dim: 256
#
# Trainer
#
trainer:
  module_name: projects.ano_brain_us.Trainer
  class_name: PTrainer
  params:
    input_size: *target_size
    checkpoint_path: *checkpoint_path
    nr_epochs: 5000
    patience: 500
    # Loss
    loss:
      module_name: model_zoo.vae_hahn
      class_name: VAELoss
      params:
        rec_log_std: 0
    # Optimizer
    lr_scheduler: "plateau"
    optimizer_params:
      #      lr: 1.0e-4 # Orig
      lr: 5.0e-5
  # Data Loader
  data_loader:
    # IXI-T1
    module_name: core.DataLoader
    class_name: DefaultDataLoader
    params:
      args:
        dataset_module:
          module_name: core.DataLoader
          class_name: DefaultDataset
        data_dir:
          train:
            - "E:\\Master Thesis\\iml-dl\\data\\augmented_train\\*"
          val:
            - "./data/augmented_val/*"
          test:
            - "./data/augmented_test/*"
        target_size: *target_size
        batch_size: 8
# Downstream tasks
downstream_tasks:
  detection:
    module_name: projects.ano_brain_us.DownstreamEvaluator
    class_name: PDownstreamEvaluator
    checkpoint_path: *checkpoint_path
    global_detection: True
    data_loader:
      module_name: core.DataLoader
      class_name: DefaultDataLoader
      params:
        args:
          target_size: *target_size
          batch_size: *dbatch_size
          dataset_module:
            module_name: core.DataLoader
            class_name: DefaultDataset
      datasets:
        Normal_brain:
          data_dir:
            test:
              - "./data/Ventricular_segmented_clean_test/*"
        global_pathology:
          data_dir:
            test:
              - "./data/anomaly_segmented/*"
  #pseudo_healthy:
  # module_name: projects.23_phanes_miccai.DownstreamEvaluator
  #class_name: PDownstreamEvaluator
  #checkpoint_path: *checkpoint_path
  #global_detection: False
  #data_loader:
  #  module_name: core.DataLoader
  #  class_name: DefaultDataLoader
  #  params:
  #    args:
  #     target_size: *target_size
  #     batch_size: *dbatch_size
  #    dataset_module:
  #     module_name: data.loaders.fastmri_loader
  #    class_name: FastLoader
  # datasets:
  #  Normal_brain:
  #   data_dir:
  #    test:
  #     - "./data/fastMRI/splits/normal_test.csv"
